#!/bin/bash

NETWORK_ALIVE=`ping -c1 google.com 2>&1 | grep unknown`
NOTIFIED="False"

notify_user () {

        notify-send -t 10000 -a "Cnchi" -i /usr/share/cnchi/data/images/antergos/antergos-icon.png "$1"
}

while [[ "$NETWORK_ALIVE" != "" ]];do
	while [[ ! -f /run/user/1000/dconf/user ]]; do
		sleep 5
	done
	if [[ ${NOTIFIED} = "False" ]]; then
		notify_user "You must be connected to the internet to install Antergos. Click the network icon in the top bar to configure your connection"
		NOTIFIED="True"
	fi
	NETWORK_ALIVE=`ping -c1 google.com 2>&1 | grep unknown`
	sleep 5
done



if [[ ${NETWORK_ALIVE} = '' ]]; then
	# make our server the first mirror for latest version of cnchi. (cnchi will run rankmirrors later)
	sed -i '1s%^%Server = http://repo.antergos.info/$repo/$arch\n%' /etc/pacman.d/antergos-mirrorlist
	killall python && notify_user "Checking for and installing available updates for Cnchi (Antergos Installer)..."
	pacman -Syy --noconfirm --needed cnchi && notify_user "Update Complete. Restarting Cnchi..."
fi
